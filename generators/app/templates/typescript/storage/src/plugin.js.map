{"version":3,"file":"plugin.js","names":["VerdaccioStoragePlugin","constructor","config","options","logger","getSecret","setSecret","secret","add","name","callback","search","onPackage","onEnd","validateName","remove","get","getPackageStorage","packageInfo","PackageStorage","saveToken","token","Error","deleteToken","user","tokenKey","readTokens","filter"],"sources":["plugin.ts"],"sourcesContent":["import {\n  Logger,\n  Callback,\n  IPluginStorage,\n  PluginOptions,\n  IPackageStorage,\n  TokenFilter,\n  Token,\n  Config,\n  onEndSearchPackage,\n  onSearchPackage,\n  onValidatePackage,\n} from '@verdaccio/types';\nimport {getInternalError} from '@verdaccio/commons-api';\n\nimport {CustomConfig} from '../types/index';\n\nimport PackageStorage from './PackageStorage';\n\nexport default class VerdaccioStoragePlugin implements IPluginStorage<CustomConfig> {\n  config: CustomConfig & Config;\n  version?: string;\n  public logger: Logger;\n  public constructor(\n      config: CustomConfig,\n      options: PluginOptions<CustomConfig>,\n  ) {\n    this.config = config;\n    this.logger = options.logger;\n  }\n\n  /**\n   *\n   */\n  public async getSecret(): Promise<string> {\n    /**\n     * return await resolveSecret();\n     */\n  }\n\n  public async setSecret(secret: string): Promise<any> {\n    /**\n     * return await getYourSecret();\n     */\n  }\n\n  /**\n   * Add a new element.\n   * @param {*} name\n   * @return {Error|*}\n   */\n  public add(name: string, callback: Callback): void {\n\n  }\n\n  /**\n   * Perform a search in your registry\n   * @param onPackage\n   * @param onEnd\n   * @param validateName\n   */\n  public search(\n      onPackage: onSearchPackage,\n      onEnd: onEndSearchPackage,\n      validateName: onValidatePackage,\n  ): void {\n    /**\n     * Example of implementation:\n     * try {\n     *  someApi.getPackages((items) => {\n     *   items.map(() => {\n     *     if (validateName(item.name)) {\n     *       onPackage(item);\n     *     }\n     *   });\n     *  onEnd();\n     * } catch(err) {\n     *   onEnd(err);\n     * }\n     * });\n     */\n  }\n\n  /**\n   * Remove an element from the database.\n   * @param {*} name\n   * @return {Error|*}\n   */\n  public remove(name: string, callback: Callback): void {\n    /**\n     * Example of implementation\n      database.getPackage(name, (item, err) => {\n        if (err) {\n          callback(getInternalError('your own message here'));\n        }\n\n        // if all goes well we return nothing\n        callback(null);\n      }\n    */\n  }\n\n  /**\n   * Return all database elements.\n   * @return {Array}\n   */\n  public get(callback: Callback): void {\n    /*\n      Example of implementation\n      database.getAll((allItems, err) => {\n        callback(err, allItems);\n      })\n    */\n  }\n\n  /**\n   * Create an instance of the `PackageStorage`\n   * @param packageInfo\n   */\n  public getPackageStorage(packageInfo: string): IPackageStorage {\n    return new PackageStorage(this.config, packageInfo, this.logger);\n  }\n\n  /**\n   * All methods for npm token support\n   * more info here https://github.com/verdaccio/verdaccio/pull/1427\n   */\n\n  public saveToken(token: Token): Promise<any> {\n    throw new Error('Method not implemented.');\n  }\n\n  public deleteToken(user: string, tokenKey: string): Promise<any> {\n    throw new Error('Method not implemented.');\n  }\n\n  public readTokens(filter: TokenFilter): Promise<Token[]> {\n    throw new Error('Method not implemented.');\n  }\n}\n"],"mappings":";;;;;;;AAiBA;;;;AAEe,MAAMA,sBAAN,CAAqE;EAI3EC,WAAW,CACdC,MADc,EAEdC,OAFc,EAGhB;IACA,KAAKD,MAAL,GAAcA,MAAd;IACA,KAAKE,MAAL,GAAcD,OAAO,CAACC,MAAtB;EACD;EAED;AACF;AACA;;;EACwB,MAATC,SAAS,GAAoB;IACxC;AACJ;AACA;EACG;;EAEqB,MAATC,SAAS,CAACC,MAAD,EAA+B;IACnD;AACJ;AACA;EACG;EAED;AACF;AACA;AACA;AACA;;;EACSC,GAAG,CAACC,IAAD,EAAeC,QAAf,EAAyC,CAElD;EAED;AACF;AACA;AACA;AACA;AACA;;;EACSC,MAAM,CACTC,SADS,EAETC,KAFS,EAGTC,YAHS,EAIL;IACN;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACG;EAED;AACF;AACA;AACA;AACA;;;EACSC,MAAM,CAACN,IAAD,EAAeC,QAAf,EAAyC;IACpD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAEG;EAED;AACF;AACA;AACA;;;EACSM,GAAG,CAACN,QAAD,EAA2B;IACnC;AACJ;AACA;AACA;AACA;AACA;EACG;EAED;AACF;AACA;AACA;;;EACSO,iBAAiB,CAACC,WAAD,EAAuC;IAC7D,OAAO,IAAIC,uBAAJ,CAAmB,KAAKjB,MAAxB,EAAgCgB,WAAhC,EAA6C,KAAKd,MAAlD,CAAP;EACD;EAED;AACF;AACA;AACA;;;EAESgB,SAAS,CAACC,KAAD,EAA6B;IAC3C,MAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN;EACD;;EAEMC,WAAW,CAACC,IAAD,EAAeC,QAAf,EAA+C;IAC/D,MAAM,IAAIH,KAAJ,CAAU,yBAAV,CAAN;EACD;;EAEMI,UAAU,CAACC,MAAD,EAAwC;IACvD,MAAM,IAAIL,KAAJ,CAAU,yBAAV,CAAN;EACD;;AAvHiF"}